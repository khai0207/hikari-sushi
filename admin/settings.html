<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramètres - HIKARI Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body class="admin-page">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-logo">
                <img src="../images/logo.png" alt="HIKARI" class="sidebar-logo-img">
                <span class="logo-text">HIKARI</span>
            </a>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item">
                    <a href="dashboard.html">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="menu.html">
                        <i class="fas fa-utensils"></i>
                        <span>Menu</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reservations.html">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Réservations</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="settings.html">
                        <i class="fas fa-cog"></i>
                        <span>Paramètres</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <button class="btn-logout" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Paramètres</h1>
            </div>
        </header>

        <!-- Settings Content -->
        <div class="settings-content">
            <!-- General Settings -->
            <section class="settings-section">
                <div class="section-header-settings">
                    <h2><i class="fas fa-store"></i> Informations du Restaurant</h2>
                </div>
                <form class="settings-form" id="generalForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="restaurantName">Nom du Restaurant</label>
                            <input type="text" id="restaurantName" name="restaurantName" value="HIKARI Sushi & Roll">
                        </div>
                        <div class="form-group">
                            <label for="phone">Téléphone</label>
                            <input type="tel" id="phone" name="phone" value="05 61 55 50 77">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" value="hikari.sushi31@gmail.com">
                        </div>
                        <div class="form-group">
                            <label for="address">Adresse</label>
                            <input type="text" id="address" name="address" value="17 allée des Soupirs, 31000 Toulouse">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="saveGeneralBtn">
                            <i class="fas fa-save"></i>
                            Enregistrer
                        </button>
                    </div>
                </form>
            </section>

            <!-- Opening Hours -->
            <section class="settings-section">
                <div class="section-header-settings">
                    <h2><i class="fas fa-clock"></i> Horaires d'Ouverture</h2>
                </div>
                <form class="settings-form" id="hoursForm">
                    <div class="hours-grid">
                        <div class="hours-row">
                            <span class="day-label">Lundi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="monday_lunch" value="Fermé">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="monday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Mardi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="tuesday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="tuesday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Mercredi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="wednesday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="wednesday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Jeudi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="thursday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="thursday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Vendredi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="friday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="friday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Samedi</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="saturday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="saturday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                        <div class="hours-row">
                            <span class="day-label">Dimanche</span>
                            <div class="hours-inputs">
                                <div class="hour-group">
                                    <label>Midi</label>
                                    <input type="text" name="sunday_lunch" value="12h - 14h30">
                                </div>
                                <div class="hour-group">
                                    <label>Soir</label>
                                    <input type="text" name="sunday_dinner" value="19h - 22h">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="saveHoursBtn">
                            <i class="fas fa-save"></i>
                            Enregistrer les Horaires
                        </button>
                    </div>
                </form>
            </section>

            <!-- Social Links -->
            <section class="settings-section">
                <div class="section-header-settings">
                    <h2><i class="fas fa-share-alt"></i> Réseaux Sociaux</h2>
                </div>
                <form class="settings-form" id="socialForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="facebook"><i class="fab fa-facebook"></i> Facebook</label>
                            <input type="url" id="facebook" name="facebook" placeholder="https://facebook.com/...">
                        </div>
                        <div class="form-group">
                            <label for="instagram"><i class="fab fa-instagram"></i> Instagram</label>
                            <input type="url" id="instagram" name="instagram" placeholder="https://instagram.com/...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tripadvisor"><i class="fab fa-tripadvisor"></i> TripAdvisor</label>
                            <input type="url" id="tripadvisor" name="tripadvisor" placeholder="https://tripadvisor.com/...">
                        </div>
                        <div class="form-group">
                            <label for="google"><i class="fab fa-google"></i> Google Maps</label>
                            <input type="url" id="google" name="google" placeholder="https://maps.google.com/...">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="saveSocialBtn">
                            <i class="fas fa-save"></i>
                            Enregistrer
                        </button>
                    </div>
                </form>
            </section>

            <!-- Zenchef Integration -->
            <section class="settings-section">
                <div class="section-header-settings">
                    <h2><i class="fas fa-plug"></i> Intégration Zenchef</h2>
                </div>
                <div class="integration-info">
                    <p>Connectez votre compte Zenchef pour gérer les réservations en ligne.</p>
                    <div class="form-group">
                        <label for="zenchefId">ID Zenchef</label>
                        <input type="text" id="zenchefId" name="zenchefId" placeholder="Votre ID Zenchef">
                    </div>
                    <div class="form-group">
                        <label for="zenchefWidget">Code Widget (optionnel)</label>
                        <textarea id="zenchefWidget" name="zenchefWidget" rows="3" placeholder="Collez le code du widget Zenchef ici..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-primary" id="saveZenchefBtn">
                            <i class="fas fa-save"></i>
                            Enregistrer
                        </button>
                    </div>
                </div>
            </section>

            <!-- Firebase Setup Guide -->
            <section class="settings-section">
                <div class="section-header-settings">
                    <h2><i class="fas fa-database"></i> Configuration Firebase</h2>
                </div>
                <div class="setup-guide">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Créer un projet Firebase</h4>
                            <p>Allez sur <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a> et créez un nouveau projet.</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Activer Authentication</h4>
                            <p>Dans Authentication > Sign-in method, activez "Email/Password".</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Créer un compte admin</h4>
                            <p>Dans Authentication > Users, ajoutez un utilisateur avec votre email et mot de passe.</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Activer Firestore</h4>
                            <p>Dans Firestore Database, créez une base de données en mode test.</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Copier la configuration</h4>
                            <p>Dans Project Settings > Your apps > Web, copiez la configuration dans <code>js/firebase-config.js</code></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="toast-icon fas fa-check-circle"></i>
        <span class="toast-message"></span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="../js/firebase-config.js"></script>

    <script>
        // Protect admin page
        HikariFirebase.protectAdminPage();

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mobileToggle = document.getElementById('mobileToggle');
        const logoutBtn = document.getElementById('logoutBtn');

        // Toggle sidebar
        sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('collapsed'));
        mobileToggle.addEventListener('click', () => sidebar.classList.toggle('mobile-open'));

        // Logout
        logoutBtn.addEventListener('click', () => HikariFirebase.logoutAdmin());

        // Show toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.querySelector('.toast-icon').className = 'toast-icon fas ' + (type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle');
            toast.querySelector('.toast-message').textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Load settings
        async function loadSettings() {
            try {
                const settings = await HikariFirebase.getSettings();
                
                // Populate general form
                document.getElementById('restaurantName').value = settings.restaurantName || '';
                document.getElementById('phone').value = settings.phone || '';
                document.getElementById('email').value = settings.email || '';
                document.getElementById('address').value = settings.address || '';
                
                // Populate social links
                document.getElementById('facebook').value = settings.facebook || '';
                document.getElementById('instagram').value = settings.instagram || '';
                document.getElementById('tripadvisor').value = settings.tripadvisor || '';
                document.getElementById('google').value = settings.google || '';
                
                // Populate Zenchef
                document.getElementById('zenchefId').value = settings.zenchefId || '';
                document.getElementById('zenchefWidget').value = settings.zenchefWidget || '';
                
                // Populate hours
                if (settings.openingHours) {
                    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                    days.forEach(day => {
                        if (settings.openingHours[day]) {
                            const lunchInput = document.querySelector(`[name="${day}_lunch"]`);
                            const dinnerInput = document.querySelector(`[name="${day}_dinner"]`);
                            if (lunchInput) lunchInput.value = settings.openingHours[day].lunch || '';
                            if (dinnerInput) dinnerInput.value = settings.openingHours[day].dinner || '';
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Save general settings
        document.getElementById('generalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                restaurantName: document.getElementById('restaurantName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value
            };
            
            const result = await HikariFirebase.updateSettings(data);
            
            if (result.success) {
                showToast('Paramètres enregistrés');
            } else {
                showToast('Erreur: ' + result.error, 'error');
            }
        });

        // Save hours
        document.getElementById('hoursForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const openingHours = {
                monday: {
                    lunch: document.querySelector('[name="monday_lunch"]').value,
                    dinner: document.querySelector('[name="monday_dinner"]').value
                },
                tuesday: {
                    lunch: document.querySelector('[name="tuesday_lunch"]').value,
                    dinner: document.querySelector('[name="tuesday_dinner"]').value
                },
                wednesday: {
                    lunch: document.querySelector('[name="wednesday_lunch"]').value,
                    dinner: document.querySelector('[name="wednesday_dinner"]').value
                },
                thursday: {
                    lunch: document.querySelector('[name="thursday_lunch"]').value,
                    dinner: document.querySelector('[name="thursday_dinner"]').value
                },
                friday: {
                    lunch: document.querySelector('[name="friday_lunch"]').value,
                    dinner: document.querySelector('[name="friday_dinner"]').value
                },
                saturday: {
                    lunch: document.querySelector('[name="saturday_lunch"]').value,
                    dinner: document.querySelector('[name="saturday_dinner"]').value
                },
                sunday: {
                    lunch: document.querySelector('[name="sunday_lunch"]').value,
                    dinner: document.querySelector('[name="sunday_dinner"]').value
                }
            };
            
            const result = await HikariFirebase.updateSettings({ openingHours });
            
            if (result.success) {
                showToast('Horaires enregistrés');
            } else {
                showToast('Erreur: ' + result.error, 'error');
            }
        });

        // Save social links
        document.getElementById('socialForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                facebook: document.getElementById('facebook').value,
                instagram: document.getElementById('instagram').value,
                tripadvisor: document.getElementById('tripadvisor').value,
                google: document.getElementById('google').value
            };
            
            const result = await HikariFirebase.updateSettings(data);
            
            if (result.success) {
                showToast('Réseaux sociaux enregistrés');
            } else {
                showToast('Erreur: ' + result.error, 'error');
            }
        });

        // Save Zenchef
        document.getElementById('saveZenchefBtn').addEventListener('click', async () => {
            const data = {
                zenchefId: document.getElementById('zenchefId').value,
                zenchefWidget: document.getElementById('zenchefWidget').value
            };
            
            const result = await HikariFirebase.updateSettings(data);
            
            if (result.success) {
                showToast('Configuration Zenchef enregistrée');
            } else {
                showToast('Erreur: ' + result.error, 'error');
            }
        });

        // Initialize
        loadSettings();
    </script>
</body>
</html>
